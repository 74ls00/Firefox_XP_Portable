<overlay id="custombuttons-profile-overlay" xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">

	<!-- Firefox -->
	<toolbarpalette id="BrowserToolbarPalette"><toolbarbutton id="custombuttons-button0" label="Подогнать по ширине окна" tooltiptext="Подогнать по ширине окна" class="toolbarbutton-1 chromeclass-toolbar-additional" context="custombuttons-contextpopup" image="data:image/gif;base64,R0lGODlhDQAQAPcAAAAAAAAAzgAI1gAY1gAx3gBC3gBK5wBS5wBj5wBr7wBr9wCM7wCc/wCl/wCt/wC1/wDO/wgh1hgp1hgxxhiE3hit5yFSziGU1iGt/yG11ikpISkpKSm1/zExKTExMTExlDF7rTGlxjGlzjk5MTk5OUJre0JrhEJ7hEqcrUrW91JSSlJSUlJSlGuEhGuEjHt7c3t7e3ucnHve75zn75zn99b399739+/39/f39///9////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////ywAAAAADQAQAAAIlwADCBwYQIKMGzgSBjCAIEECBAQicJhRA2GABA0cZDwQgUEKijguOoBAEkFHCB9DJhhZcgCDlxhksKDAEgICAQRyWoixAkQFkhAWFBg64YMKACtQAF2K4igAAB5aLIXQosNTACROZJia4cQIABtMhJhKMkSJDTAu1Fzq4MILkWQhOEggEKNGB3jxMqC7sOFDh34NEBw8OCAAOw==" cb-oncommand="&#xA;&#xA;// ==UserScript==&#xA;// @name Custom Buttons&#xA;// @namespace http://www.greasespot.net/&#xA;// @include http://custombuttons.mozdev.org/drupal/content/*&#xA;// @exclude http://custombuttons.mozdev.org/drupal/content/main-page&#xA;// @exclude http://custombuttons.mozdev.org/drupal/content/custom-buttons-documentation&#xA;// ==/UserScript==&#xA; &#xA; if(content.document.getElementById(&quot;sidebar-left&quot;))&#xA; {&#xA;    content.document.getElementById(&quot;sidebar-left&quot;).style.display = &quot;none&quot;;&#xA; }&#xA; &#xA;&#xA; &#xA;var d = content.document;&#xA;var s = d.createElement(&quot;style&quot;);&#xA;s.type = &quot;text/css&quot;;&#xA;s.innerHTML = &quot;#sidebar-left + td { padding-left: 0 }&quot;;&#xA;var h = d.getElementsByTagName(&quot;head&quot;)[0];&#xA;h.appendChild(s);&#xA; &#xA;var p = content.document.getElementsByTagName(&quot;pre&quot;);&#xA;for (var i = 0; i &lt; p.length; i++) {&#xA;  p[i].style.overflow = &quot;auto&quot;;&#xA;  if (p[i].textContent.indexOf(&quot;data:image&quot;) == -1) {&#xA;    p[i].style.whiteSpace = &quot;pre-wrap&quot;;&#xA;    p[i].style.wordWrap = &quot;break-word&quot;;&#xA;  }&#xA;}&#xA; &#xA;/* double click to select all */&#xA; &#xA;//var d = document;&#xA;//var p = d.getElementsByTagName(&quot;pre&quot;);&#xA;for (var i = 0; i &lt; p.length; i++) {&#xA;  p[i].addEventListener(&quot;dblclick&quot;, function () {&#xA;    var s = getSelection();&#xA;    var r = d.createRange();&#xA;    r.selectNodeContents(this);&#xA;    s.removeAllRanges();&#xA;    s.addRange(r);&#xA;  }, false);&#xA;}&#xA; &#xA;/* fit to width */&#xA; &#xA;function t(f) {&#xA;  var a = d.createNodeIterator(d, 1, f, false);&#xA;  while (a.nextNode()) {}&#xA;}&#xA;//var d = document;&#xA;t(function (e) {&#xA;  var x = e.offsetLeft;&#xA;  var l = e.offsetParent;&#xA;  while (l != null) {&#xA;    x += l.offsetLeft;&#xA;    l = l.offsetParent;&#xA;  }&#xA;  var w = d.documentElement.clientWidth - x;&#xA;  var s = e.style;&#xA;  if (s.marginLeft) w -= s.marginLeft;&#xA;  if (s.marginRight) w -= s.marginRight;&#xA;  if (s.paddingLeft) w -= s.paddingLeft;&#xA;  if (s.paddingRight) w -= s.paddingRight;&#xA;  if (s.borderWidth) w -= s.borderWidth;&#xA;  w -= d.defaultView.innerWidth - d.documentElement.offsetWidth;&#xA;  if (e.tagName == &quot;IMG&quot;) {&#xA;    var h = e.clientHeight * w / e.clientWidth;&#xA;    s.maxHeight = h;&#xA;  }&#xA;  s.maxWidth = w + &quot;px&quot;;&#xA;});" cb-init="/*Initialization Code*/" cb-mode="0" Help="Fit to width 2"/><toolbarbutton id="custombuttons-button2" label="Восстановить вкладки" tooltiptext="Восстановить вкладки" class="toolbarbutton-1 chromeclass-toolbar-additional" context="custombuttons-contextpopup" image="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABZVBMVEX////w8PD09PTx8fHw8PCPkIvv7++LjIfw8PDu7u6ZmZXv7+/29vbw8PD///+Txdt8lJ2RkY2Sk4+bzeJcnLsbcp6LjIcwf6bg4N/m//+XyuDf7/+LvNGmr68ufqbg4N9OhaLm8PJvrstCjrPg4N9Rk7Q8hqfk8PRoqMc5h60vgKk9ia/f4N7w8PDi7/ZgpMOLtMny9fYmeaIqfaff4N6hpKLv7+/h8PVwqcTB1N3L3ebv7+9trMqLjIeOj4rf39719vbM7PaMt81hpMPL7fmbnJeoqaXr6+tin774+/vF2t+lq6qKlI+hop38/Pz7+/v5+fn9/f29vruLjIeqq6f7+/v5+fnGxsSLjId5rcfg8vw4ibN8ud3n8vgacZ2extrA5//4+/wacp4yha8ZcZ18wuyIxuthrNc5irdvt+KRzvO62ep+w+7N6PeY1/+U1v+h2/9am7sbcp4keaXm8/ovgq07jLe+yJo8AAAAWXRSTlMAES5KZr+CMJ7X7Lr4ZwHdD4f0yftxJtP6Cj4Q/EIe9HPg/tXy/kvL/fr++fGfuf3Bzv787+6DptCRyLvRDs/u+P3O+TSw5Or8ovXiHqKWW0aBpyVHNSZMDw1FfDAAAACvSURBVHhehchTcwRBAIXRXmewtG3btm0jtn9/elPZmpqnnKd7P0DgADK5glyUQpH4b0pYkJo730t1PADxBSiKhlVvT4v11myBgSHD8Vz+cP388rr7rGlg0CIIojccrx5v7u4fjDCYMAxLWm1f33bHcuWEwXUBuT3eS58/cBuEIcQ8iURj8cT7RwqkM1n6LzabXtgUS6BcqdLO6o1mC7Q7XepZrz8YgtGYQphMZ+BfP976HHRDoNUhAAAAAElFTkSuQmCC" cb-oncommand="if(!event.target) // Button's hotkey pressed&#xA;&#x9;this.undoCloseTabsList.drawUndoList() &amp;&amp; this.undoCloseTabsList.openMenu();" cb-init="// http://infocatcher.ucoz.net/js/cb/undoCloseTabs.js&#xA;// https://forum.mozilla-russia.org/viewtopic.php?id=56267&#xA;// https://github.com/Infocatcher/Custom_Buttons/tree/master/Undo_Close_Tabs&#xA;&#xA;// Undo Close Tabs button for Custom Buttons&#xA;// (code for &quot;initialization&quot; section)&#xA;&#xA;// (c) Infocatcher 2009-2013&#xA;// version 0.3.2 - 2013-12-23&#xA;&#xA;var options = {&#xA;&#x9;menuTemplate: [&#xA;&#x9;&#x9;&quot;closedWindows&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;restoreClosedWindows&quot;,&#xA;&#x9;&#x9;&quot;clearClosedWindows&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;closedTabs&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;restoreClosedTabs&quot;,&#xA;&#x9;&#x9;&quot;clearClosedTabs&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;clearAll&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;restoreLastSession&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;buttonMenu&quot;&#xA;&#x9;],&#xA;&#x9;showInTabContextMenu: false,&#xA;&#x9;/*&#xA;&#x9;menuTemplateTabContext: [ // like menuTemplate&#xA;&#x9;&#x9;&quot;closedTabs&quot;,&#xA;&#x9;&#x9;&quot;separator&quot;,&#xA;&#x9;&#x9;&quot;restoreClosedTabs&quot;,&#xA;&#x9;&#x9;&quot;clearClosedTabs&quot;&#xA;&#x9;],&#xA;&#x9;*/&#xA;&#x9;hideRestoreAllForSingleEntry: false,&#xA;&#x9;allowDeleteEntries: true,&#xA;&#x9;accesskeys: { // Empty string (&quot;&quot;) to disable or string with possible values (&quot;0123...&quot;, &quot;abcd...&quot;)&#xA;&#x9;&#x9;closedTabs: &quot;&quot;,&#xA;&#x9;&#x9;closedWindows: &quot;&quot;&#xA;&#x9;},&#xA;&#x9;accesskeyPostfix: &quot; &quot;, // &lt;accesskey&gt;&lt;postfix&gt;&lt;label&gt;&#xA;&#x9;openMenuOnMouseover: false,&#xA;&#x9;useMenu: false,&#xA;&#x9;rightClickToUndoCloseTab: false // Useful with &quot;useMenu: true&quot;&#xA;};&#xA;&#xA;function _localize(sid) {&#xA;&#x9;var strings = {&#xA;&#x9;&#x9;en: {&#xA;&#x9;&#x9;&#x9;restoreTab: &quot;Restore the most recently closed tab&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreAllTabs: &quot;Restore all tabs&quot;,&#xA;&#x9;&#x9;&#x9;restoreAllTabsAccesskey: &quot;t&quot;,&#xA;&#x9;&#x9;&#x9;clearTabsHistory: &quot;Clear history of closed tabs&quot;,&#xA;&#x9;&#x9;&#x9;clearTabsHistoryAccesskey: &quot;b&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreAllWindows: &quot;Restore all windows&quot;,&#xA;&#x9;&#x9;&#x9;restoreAllWindowsAccesskey: &quot;w&quot;,&#xA;&#x9;&#x9;&#x9;clearWindowsHistory: &quot;Clear history of closed windows&quot;,&#xA;&#x9;&#x9;&#x9;clearWindowsHistoryAccesskey: &quot;d&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;clearAllHistory: &quot;Clear all history&quot;,&#xA;&#x9;&#x9;&#x9;clearAllHistoryAccesskey: &quot;C&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreLastSession: &quot;Restore last session&quot;,&#xA;&#x9;&#x9;&#x9;restoreLastSessionAccesskey: &quot;s&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;deleteUndoEntry: &quot;Delete&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;buttonMenu: &quot;Button menu&quot;,&#xA;&#x9;&#x9;&#x9;buttonMenuAccesskey: &quot;m&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;tabContextMenu: &quot;Recently Closed Tabs&quot;,&#xA;&#x9;&#x9;&#x9;tabContextMenuAccesskey: &quot;y&quot;&#xA;&#x9;&#x9;},&#xA;&#x9;&#x9;ru: {&#xA;&#x9;&#x9;&#x9;restoreTab: &quot;Восстановить последнюю закрытую вкладку&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreAllTabs: &quot;Восстановить все вкладки&quot;,&#xA;&#x9;&#x9;&#x9;restoreAllTabsAccesskey: &quot;л&quot;,&#xA;&#x9;&#x9;&#x9;clearTabsHistory: &quot;Очистить историю закрытых вкладок&quot;,&#xA;&#x9;&#x9;&#x9;clearTabsHistoryAccesskey: &quot;д&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreAllWindows: &quot;Восстановить все окна&quot;,&#xA;&#x9;&#x9;&#x9;restoreAllWindowsAccesskey: &quot;о&quot;,&#xA;&#x9;&#x9;&#x9;clearWindowsHistory: &quot;Очистить историю закрытых окон&quot;,&#xA;&#x9;&#x9;&#x9;clearWindowsHistoryAccesskey: &quot;н&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;clearAllHistory: &quot;Очистить всю историю&quot;,&#xA;&#x9;&#x9;&#x9;clearAllHistoryAccesskey: &quot;ч&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;restoreLastSession: &quot;Восстановить последнюю сессию&quot;,&#xA;&#x9;&#x9;&#x9;restoreLastSessionAccesskey: &quot;с&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;deleteUndoEntry: &quot;Удалить&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;buttonMenu: &quot;Меню кнопки&quot;,&#xA;&#x9;&#x9;&#x9;buttonMenuAccesskey: &quot;М&quot;,&#xA;&#xA;&#x9;&#x9;&#x9;tabContextMenu: &quot;Недавно закрытые вкладки&quot;,&#xA;&#x9;&#x9;&#x9;tabContextMenuAccesskey: &quot;о&quot;&#xA;&#x9;&#x9;}&#xA;&#x9;};&#xA;&#x9;var locale = (function() {&#xA;&#x9;&#x9;//var prefs = Services.prefs;&#xA;&#x9;&#x9;var prefs = Components.classes[&quot;@mozilla.org/preferences-service;1&quot;]&#xA;&#x9;&#x9;&#x9;.getService(Components.interfaces.nsIPrefBranch);&#xA;&#x9;&#x9;if(!prefs.getBoolPref(&quot;intl.locale.matchOS&quot;)) {&#xA;&#x9;&#x9;&#x9;var locale = prefs.getCharPref(&quot;general.useragent.locale&quot;);&#xA;&#x9;&#x9;&#x9;if(locale.substr(0, 9) != &quot;chrome://&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;return locale;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return Components.classes[&quot;@mozilla.org/chrome/chrome-registry;1&quot;]&#xA;&#x9;&#x9;&#x9;.getService(Components.interfaces.nsIXULChromeRegistry)&#xA;&#x9;&#x9;&#x9;.getSelectedLocale(&quot;global&quot;);&#xA;&#x9;})().match(/^[a-z]*/)[0];&#xA;&#x9;_localize = function(sid) {&#xA;&#x9;&#x9;return strings[locale] &amp;&amp; strings[locale][sid] || strings.en[sid] || sid;&#xA;&#x9;};&#xA;&#x9;return _localize.apply(this, arguments);&#xA;}&#xA;&#xA;var JSON = &quot;JSON&quot; in window&#xA;&#x9;? window.JSON&#xA;&#x9;: &quot;nsIJSON&quot; in Components.interfaces&#xA;&#x9;&#x9;? {&#xA;&#x9;&#x9;&#x9;parse: function(s) {&#xA;&#x9;&#x9;&#x9;&#x9;return Components.classes[&quot;@mozilla.org/dom/json;1&quot;]&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;.createInstance(Components.interfaces.nsIJSON)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;.decode(s);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;: {&#xA;&#x9;&#x9;&#x9;parse: function(s) {&#xA;&#x9;&#x9;&#x9;&#x9;return Components.utils.evalInSandbox(&quot;(&quot; + s + &quot;)&quot;, new Components.utils.Sandbox(&quot;about:blank&quot;));&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;};&#xA;&#xA;this.onclick = function(e) {&#xA;&#x9;if(e.target != this)&#xA;&#x9;&#x9;return;&#xA;&#x9;if(e.button == 1 || e.button == 0 &amp;&amp; (e.ctrlKey || e.shiftKey || e.altKey || e.metaKey))&#xA;&#x9;&#x9;this.undoCloseTabsList.clearAllLists();&#xA;&#x9;else if(&#xA;&#x9;&#x9;e.button == 0&#xA;&#x9;&#x9;|| e.button == 2 &amp;&amp; !e.ctrlKey &amp;&amp; !e.shiftKey &amp;&amp; !e.altKey &amp;&amp; !e.metaKey&#xA;&#x9;&#x9;&#x9;&amp;&amp; this.undoCloseTabsList.options.rightClickToUndoCloseTab&#xA;&#x9;) {&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;e.button == 0 &amp;&amp; !this.undoCloseTabsList.options.useMenu&#xA;&#x9;&#x9;&#x9;|| e.button == 2 &amp;&amp; this.undoCloseTabsList.options.rightClickToUndoCloseTab&#xA;&#x9;&#x9;) {&#xA;&#x9;&#x9;&#x9;if(this.undoCloseTabsList.closedTabCount)&#xA;&#x9;&#x9;&#x9;&#x9;this.undoCloseTabsList.undoCloseTab();&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;this.undoCloseTabsList.drawUndoList() &amp;&amp; this.undoCloseTabsList.showMenu(e);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;// Allow use &quot;command&quot; section only from hotkey:&#xA;&#x9;&#x9;e.preventDefault();&#xA;&#x9;&#x9;e.stopPropagation();&#xA;&#x9;}&#xA;};&#xA;if(!this.hasOwnProperty(&quot;defaultContextId&quot;))&#xA;&#x9;this.defaultContextId = this.getAttribute(&quot;context&quot;) || &quot;custombuttons-contextpopup&quot;;&#xA;this.onmousedown = function(e) {&#xA;&#x9;if(e.target != this)&#xA;&#x9;&#x9;return;&#xA;&#x9;if(this.undoCloseTabsList.options.useMenu) {&#xA;&#x9;&#x9;if(e.button == 0)&#xA;&#x9;&#x9;&#x9;this.undoCloseTabsList.drawUndoList();&#xA;&#x9;}&#xA;&#x9;else if(e.button == 2) {&#xA;&#x9;&#x9;var showCbMenu = e.ctrlKey || e.shiftKey || e.altKey || e.metaKey || !this.undoCloseTabsList.drawUndoList();&#xA;&#x9;&#x9;this.setAttribute(&#xA;&#x9;&#x9;&#x9;&quot;context&quot;,&#xA;&#x9;&#x9;&#x9;showCbMenu&#xA;&#x9;&#x9;&#x9;&#x9;? this.defaultContextId&#xA;&#x9;&#x9;&#x9;&#x9;: this.undoCloseTabsList.mpId&#xA;&#x9;&#x9;);&#xA;&#x9;}&#xA;};&#xA;this.onmouseover = function(e) {&#xA;&#x9;if(e.target != this)&#xA;&#x9;&#x9;return;&#xA;&#x9;if(!this.disabled)&#xA;&#x9;&#x9;this.undoCloseTabsList.updUI();&#xA;&#x9;this.undoCloseTabsList.options.useMenu &amp;&amp; Array.some(&#xA;&#x9;&#x9;this.parentNode.getElementsByTagName(&quot;*&quot;),&#xA;&#x9;&#x9;function(node) {&#xA;&#x9;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;&#x9;node != this&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; node.namespaceURI == xulns&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; node.boxObject&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; node.boxObject instanceof Components.interfaces.nsIMenuBoxObject&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; node.open&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; this.undoCloseTabsList.drawUndoList()&#xA;&#x9;&#x9;&#x9;) {&#xA;&#x9;&#x9;&#x9;&#x9;node.open = false;&#xA;&#x9;&#x9;&#x9;&#x9;this.open = true;&#xA;&#x9;&#x9;&#x9;&#x9;return true;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;return false;&#xA;&#x9;&#x9;},&#xA;&#x9;&#x9;this&#xA;&#x9;);&#xA;&#x9;if(&#xA;&#x9;&#x9;this.undoCloseTabsList.options.openMenuOnMouseover&#xA;&#x9;&#x9;&amp;&amp; this.undoCloseTabsList.drawUndoList()&#xA;&#x9;)&#xA;&#x9;&#x9;this.undoCloseTabsList.openMenu();&#xA;};&#xA;&#xA;this.undoCloseTabsList = {&#xA;&#x9;button: this,&#xA;&#x9;options: options,&#xA;&#x9;mpId: this.id + &quot;-context&quot;,&#xA;&#x9;cmId: this.id + &quot;-contextSub&quot;,&#xA;&#x9;errPrefix: &quot;[Custom Buttons :: Undo Close Tabs List]: &quot;,&#xA;&#x9;get mp() {&#xA;&#x9;&#x9;var mp = this.createElement(&quot;menupopup&quot;, {&#xA;&#x9;&#x9;&#x9;id: this.mpId,&#xA;&#x9;&#x9;&#x9;onclick: &quot;this.parentNode.undoCloseTabsList.checkForMiddleClick(event);&quot;,&#xA;&#x9;&#x9;&#x9;onpopupshowing: &quot;if(event.target == this) document.popupNode = this.parentNode;&quot;,&#xA;&#x9;&#x9;&#x9;onpopuphidden: &quot;if(event.target == this) document.popupNode = null;&quot;&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;if(this.cm)&#xA;&#x9;&#x9;&#x9;mp.setAttribute(&quot;context&quot;, this.cmId);&#xA;&#x9;&#x9;delete this.mp;&#xA;&#x9;&#x9;return this.mp = this.button.appendChild(mp);&#xA;&#x9;},&#xA;&#x9;get cm() {&#xA;&#x9;&#x9;delete this.cm;&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;!this.options.allowDeleteEntries&#xA;&#x9;&#x9;&#x9;|| !(&quot;forgetClosedTab&quot; in this.ss || &quot;forgetClosedWindow&quot; in this.ss)&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;return this.cm = null;&#xA;&#x9;&#x9;var cm = document.getElementById(this.cmId);&#xA;&#x9;&#x9;cm &amp;&amp; cm.parentNode.removeChild(cm);&#xA;&#x9;&#x9;cm = this.createElement(&quot;menupopup&quot;, {&#xA;&#x9;&#x9;&#x9;id: this.cmId,&#xA;&#x9;&#x9;&#x9;onpopupshowing: &quot;return this.undoCloseTabsList.canDeleteUndoEntry(this.triggerNode || document.popupNode);&quot;&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;var mi = this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.undoCloseTabsList.deleteUndoEntry(this.parentNode.triggerNode || document.popupNode);&quot;,&#xA;&#x9;&#x9;&#x9;label: _localize(&quot;deleteUndoEntry&quot;),&#xA;&#x9;&#x9;&#x9;closemenu: &quot;single&quot;&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;cm.appendChild(mi);&#xA;&#x9;&#x9;cm.undoCloseTabsList = this;&#xA;&#x9;&#x9;return this.cm = document.getElementById(&quot;mainPopupSet&quot;).appendChild(cm);&#xA;&#x9;},&#xA;&#x9;get cbMenu() {&#xA;&#x9;&#x9;var cbPopup = document.getElementById(this.button.defaultContextId);&#xA;&#x9;&#x9;if(!cbPopup) {&#xA;&#x9;&#x9;&#x9;Components.utils.reportError(this.errPrefix + &quot;cb menu not found&quot;);&#xA;&#x9;&#x9;&#x9;return this.cbMenu = null;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;cbPopup = cbPopup.cloneNode(true);&#xA;&#x9;&#x9;var id = &quot;-&quot; + this.button.id.match(/\d*$/)[0] + &quot;-cloned&quot;;&#xA;&#x9;&#x9;cbPopup.id += id;&#xA;&#x9;&#x9;Array.slice(cbPopup.getElementsByAttribute(&quot;id&quot;, &quot;*&quot;)).forEach(function(node) {&#xA;&#x9;&#x9;&#x9;node.id += id;&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;var menu = this.createElement(&quot;menu&quot;, {&#xA;&#x9;&#x9;&#x9;label: _localize(&quot;buttonMenu&quot;),&#xA;&#x9;&#x9;&#x9;accesskey: _localize(&quot;buttonMenuAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;menu.appendChild(cbPopup);&#xA;&#x9;&#x9;cbPopup.setAttribute(&#xA;&#x9;&#x9;&#x9;&quot;onpopupshowing&quot;,&#xA;&#x9;&#x9;&#x9;'\&#xA;&#x9;&#x9;&#x9;var btn = document.popupNode = this.parentNode.parentNode.parentNode\n\&#xA;&#x9;&#x9;&#x9;&#x9;.undoCloseTabsList.button;\n\&#xA;&#x9;&#x9;&#x9;custombutton.setContextMenuVisibility(btn);'&#xA;&#x9;&#x9;);&#xA;&#x9;&#x9;delete this.cbMenu;&#xA;&#x9;&#x9;return this.cbMenu = menu;&#xA;&#x9;},&#xA;&#x9;get ss() {&#xA;&#x9;&#x9;delete this.ss;&#xA;&#x9;&#x9;return this.ss = (&#xA;&#x9;&#x9;&#x9;Components.classes[&quot;@mozilla.org/browser/sessionstore;1&quot;]&#xA;&#x9;&#x9;&#x9;|| Components.classes[&quot;@mozilla.org/suite/sessionstore;1&quot;]&#xA;&#x9;&#x9;).getService(Components.interfaces.nsISessionStore);&#xA;&#x9;},&#xA;&#x9;get appInfo() {&#xA;&#x9;&#x9;delete this.appInfo;&#xA;&#x9;&#x9;return this.appInfo = Components.classes[&quot;@mozilla.org/xre/app-info;1&quot;]&#xA;&#x9;&#x9;&#x9;.getService(Components.interfaces.nsIXULAppInfo);&#xA;&#x9;},&#xA;&#x9;get appVersion() {&#xA;&#x9;&#x9;delete this.appVersion;&#xA;&#x9;&#x9;return this.appVersion = parseFloat(this.appInfo.version);&#xA;&#x9;},&#xA;&#x9;get appName() {&#xA;&#x9;&#x9;delete this.appName;&#xA;&#x9;&#x9;return this.appName = this.appInfo.name;&#xA;&#x9;},&#xA;&#xA;&#x9;init: function() {&#xA;&#x9;&#x9;window.addEventListener(&quot;TabClose&quot;,       this, false);&#xA;&#x9;&#x9;window.addEventListener(&quot;SSTabRestoring&quot;, this, false);&#xA;&#x9;&#x9;window.addEventListener(&quot;unload&quot;,         this, false);&#xA;&#x9;&#x9;if(this.appName == &quot;SeaMonkey&quot;) // No SSTab* events in SeaMonkey&#xA;&#x9;&#x9;&#x9;window.addEventListener(&quot;TabOpen&quot;, this, false);&#xA;&#x9;&#x9;this.mp.addEventListener(&quot;DOMMenuItemActive&quot;,   this, false);&#xA;&#x9;&#x9;this.mp.addEventListener(&quot;DOMMenuItemInactive&quot;, this, false);&#xA;&#x9;&#x9;this.updUIGlobal();&#xA;&#x9;&#x9;if(this.options.showInTabContextMenu) setTimeout(function(_this) {&#xA;&#x9;&#x9;&#x9;_this.initTabContext();&#xA;&#x9;&#x9;}, 100, this);&#xA;&#x9;},&#xA;&#x9;initTabContext: function() {&#xA;&#x9;&#x9;var origMi = this.tabContextUndoClose;&#xA;&#x9;&#x9;if(!origMi) {&#xA;&#x9;&#x9;&#x9;LOG(&quot;Can't find \&quot;Undo Close Tab\&quot; item in tab context menu&quot;);&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;var menuId = this.button.id + &quot;-tabContextMenu&quot;;&#xA;&#x9;&#x9;var menu = document.getElementById(menuId);&#xA;&#x9;&#x9;menu &amp;&amp; menu.parentNode.removeChild(menu); // For SeaMonkey&#xA;&#x9;&#x9;menu = this.createElement(&quot;menu&quot;, {&#xA;&#x9;&#x9;&#x9;id: menuId,&#xA;&#x9;&#x9;&#x9;label: _localize(&quot;tabContextMenu&quot;),&#xA;&#x9;&#x9;&#x9;accesskey: _localize(&quot;tabContextMenuAccesskey&quot;)&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;menu.undoCloseTabsList = this;&#xA;&#x9;&#x9;var origMp = this.mp;&#xA;&#x9;&#x9;var mp = origMp.cloneNode(true);&#xA;&#x9;&#x9;mp.id = this.button.id + &quot;-tabContext&quot;;&#xA;&#x9;&#x9;var _this = this;&#xA;&#x9;&#x9;function drawUndoList() {&#xA;&#x9;&#x9;&#x9;var ok = false;&#xA;&#x9;&#x9;&#x9;var opts = _this.options;&#xA;&#x9;&#x9;&#x9;var origTemplate = opts.menuTemplate;&#xA;&#x9;&#x9;&#x9;opts.menuTemplate = opts.menuTemplateTabContext || origTemplate;&#xA;&#x9;&#x9;&#x9;_this.mp = mp;&#xA;&#x9;&#x9;&#x9;try {&#xA;&#x9;&#x9;&#x9;&#x9;ok = _this.drawUndoList();&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;catch(e) {&#xA;&#x9;&#x9;&#x9;&#x9;Components.utils.reportError(e);&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;opts.menuTemplate = origTemplate;&#xA;&#x9;&#x9;&#x9;_this.mp = origMp;&#xA;&#x9;&#x9;&#x9;return ok;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;function updMenu() {&#xA;&#x9;&#x9;&#x9;if(drawUndoList())&#xA;&#x9;&#x9;&#x9;&#x9;menu.removeAttribute(&quot;disabled&quot;);&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;menu.setAttribute(&quot;disabled&quot;, &quot;true&quot;);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;mp._updatePopup = function(e) {&#xA;&#x9;&#x9;&#x9;if(e.target != this)&#xA;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;document.popupNode = _this.button;&#xA;&#x9;&#x9;&#x9;drawUndoList();&#xA;&#x9;&#x9;};&#xA;&#x9;&#x9;mp.setAttribute(&quot;onpopupshowing&quot;, &quot;this._updatePopup(event);&quot;);&#xA;&#x9;&#x9;mp.onclick = function(e) {&#xA;&#x9;&#x9;&#x9;_this.checkForMiddleClick(e, updMenu);&#xA;&#x9;&#x9;};&#xA;&#x9;&#x9;menu.appendChild(mp);&#xA;&#x9;&#x9;addEventListener(&quot;popupshown&quot;, function(e) {&#xA;&#x9;&#x9;&#x9;if(e.target == e.currentTarget)&#xA;&#x9;&#x9;&#x9;&#x9;setTimeout(updMenu, 0); // Pseudo async&#xA;&#x9;&#x9;}, false, origMi.parentNode);&#xA;&#x9;&#x9;addEventListener(&quot;DOMMenuItemActive&quot;,   this, false, mp);&#xA;&#x9;&#x9;addEventListener(&quot;DOMMenuItemInactive&quot;, this, false, mp);&#xA;&#x9;&#x9;origMi.parentNode.insertBefore(menu, origMi.nextSibling);&#xA;&#x9;&#x9;origMi.setAttribute(&quot;hidden&quot;, &quot;true&quot;);&#xA;&#x9;},&#xA;&#x9;destroy: function() {&#xA;&#x9;&#x9;window.removeEventListener(&quot;TabClose&quot;,       this, false);&#xA;&#x9;&#x9;window.removeEventListener(&quot;SSTabRestoring&quot;, this, false);&#xA;&#x9;&#x9;window.removeEventListener(&quot;unload&quot;,         this, false);&#xA;&#x9;&#x9;if(this.appName == &quot;SeaMonkey&quot;)&#xA;&#x9;&#x9;&#x9;window.removeEventListener(&quot;TabOpen&quot;, this, false);&#xA;&#x9;&#x9;this.mp.removeEventListener(&quot;DOMMenuItemActive&quot;,   this, false);&#xA;&#x9;&#x9;this.mp.removeEventListener(&quot;DOMMenuItemInactive&quot;, this, false);&#xA;&#x9;&#x9;var menu = document.getElementById(this.button.id + &quot;-tabContextMenu&quot;);&#xA;&#x9;&#x9;if(menu) {&#xA;&#x9;&#x9;&#x9;menu.parentNode.removeChild(menu);&#xA;&#x9;&#x9;&#x9;this.tabContextUndoClose.removeAttribute(&quot;hidden&quot;);&#xA;&#x9;&#x9;}&#xA;&#x9;},&#xA;&#x9;handleEvent: function(e) {&#xA;&#x9;&#x9;switch(e.type) {&#xA;&#x9;&#x9;&#x9;case &quot;TabClose&quot;:&#xA;&#x9;&#x9;&#x9;case &quot;SSTabRestoring&quot;:&#xA;&#x9;&#x9;&#x9;case &quot;TabOpen&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;setTimeout(function(_this) {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;_this.updUI();&#xA;&#x9;&#x9;&#x9;&#x9;}, 0, this);&#xA;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;case &quot;DOMMenuItemActive&quot;:&#xA;&#x9;&#x9;&#x9;case &quot;DOMMenuItemInactive&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;if(!(&quot;XULBrowserWindow&quot; in window))&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;XULBrowserWindow.setOverLink(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;e.type == &quot;DOMMenuItemActive&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;? (e.target.getAttribute(&quot;tooltiptext&quot;) || &quot;&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;.replace(/ \n/g, &quot;, &quot;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;null&#xA;&#x9;&#x9;&#x9;&#x9;);&#xA;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;case &quot;unload&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;this.updUIGlobal();&#xA;&#x9;&#x9;&#x9;&#x9;this.destroy();&#xA;&#x9;&#x9;}&#xA;&#x9;},&#xA;&#xA;&#x9;createElement: function(name, attrs) {&#xA;&#x9;&#x9;var node = document.createElement(name);&#xA;&#x9;&#x9;if(attrs) for(var attrName in attrs) if(attrs.hasOwnProperty(attrName))&#xA;&#x9;&#x9;&#x9;node.setAttribute(attrName, attrs[attrName]);&#xA;&#x9;&#x9;return node;&#xA;&#x9;},&#xA;&#x9;get tabContextUndoClose() {&#xA;&#x9;&#x9;return document.getElementById(&quot;context_undoCloseTab&quot;)&#xA;&#x9;&#x9;&#x9;|| document.getAnonymousElementByAttribute(gBrowser, &quot;tbattr&quot;, &quot;tabbrowser-undoclosetab&quot;);&#xA;&#x9;},&#xA;&#x9;get closedWindowCount() {&#xA;&#x9;&#x9;if(!(&quot;getClosedWindowCount&quot; in this.ss)) {&#xA;&#x9;&#x9;&#x9;delete this.closedWindowCount;&#xA;&#x9;&#x9;&#x9;return this.closedWindowCount = 0;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;this.__defineGetter__(&quot;closedWindowCount&quot;, function() {&#xA;&#x9;&#x9;&#x9;return this.ss.getClosedWindowCount();&#xA;&#x9;&#x9;});&#xA;&#x9;&#x9;return this.closedWindowCount;&#xA;&#x9;},&#xA;&#x9;get closedTabCount() {&#xA;&#x9;&#x9;return this.ss.getClosedTabCount(window);&#xA;&#x9;},&#xA;&#x9;undoCloseTab: function(i) {&#xA;&#x9;&#x9;if(&quot;undoCloseTab&quot; in window) // Firefox 2.0+&#xA;&#x9;&#x9;&#x9;undoCloseTab(i);&#xA;&#x9;&#x9;else // SeaMonkey&#xA;&#x9;&#x9;&#x9;gBrowser.undoCloseTab(i);&#xA;&#x9;},&#xA;&#x9;clearUndoTabsList: function() {&#xA;&#x9;&#x9;var closedTabCount = this.closedTabCount;&#xA;&#x9;&#x9;if(!closedTabCount)&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;if(&quot;forgetClosedTab&quot; in this.ss) // Gecko 1.9.2+&#xA;&#x9;&#x9;&#x9;while(closedTabCount--)&#xA;&#x9;&#x9;&#x9;&#x9;this.ss.forgetClosedTab(window, 0);&#xA;&#x9;&#x9;else {&#xA;&#x9;&#x9;&#x9;// Doesn't work in SeaMonkey&#xA;&#x9;&#x9;&#x9;const pName = &quot;browser.sessionstore.max_tabs_undo&quot;;&#xA;&#x9;&#x9;&#x9;let val = cbu.getPrefs(pName);&#xA;&#x9;&#x9;&#x9;cbu.setPrefs(pName, 0);&#xA;&#x9;&#x9;&#x9;cbu.setPrefs(pName, val);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;this.updUIGlobal();&#xA;&#x9;},&#xA;&#x9;clearUndoWindowsList: function() {&#xA;&#x9;&#x9;var closedWindowCount = this.closedWindowCount;&#xA;&#x9;&#x9;if(!closedWindowCount)&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;if(&quot;forgetClosedWindow&quot; in this.ss) // Gecko 1.9.2+&#xA;&#x9;&#x9;&#x9;while(closedWindowCount--)&#xA;&#x9;&#x9;&#x9;&#x9;this.ss.forgetClosedWindow(0);&#xA;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;this.ss.setWindowState(window, '{&quot;windows&quot;:[{}],&quot;_closedWindows&quot;:[]}', false);&#xA;&#x9;&#x9;this.updUIGlobal();&#xA;&#x9;},&#xA;&#x9;clearAllLists: function() {&#xA;&#x9;&#x9;this.clearUndoTabsList();&#xA;&#x9;&#x9;this.clearUndoWindowsList();&#xA;&#x9;},&#xA;&#x9;canDeleteUndoEntry: function(mi) {&#xA;&#x9;&#x9;switch(mi.getAttribute(&quot;cb_type&quot;)) {&#xA;&#x9;&#x9;&#x9;case &quot;tab&quot;:    return &quot;forgetClosedTab&quot;    in this.ss;&#xA;&#x9;&#x9;&#x9;case &quot;window&quot;: return &quot;forgetClosedWindow&quot; in this.ss;&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return false;&#xA;&#x9;},&#xA;&#x9;deleteUndoEntry: function(mi) {&#xA;&#x9;&#x9;var i = +mi.getAttribute(&quot;cb_index&quot;);&#xA;&#x9;&#x9;if(mi.getAttribute(&quot;cb_type&quot;) == &quot;window&quot;) {&#xA;&#x9;&#x9;&#x9;this.ss.forgetClosedWindow(i);&#xA;&#x9;&#x9;&#x9;this.updUIGlobal();&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;else {&#xA;&#x9;&#x9;&#x9;this.ss.forgetClosedTab(window, i);&#xA;&#x9;&#x9;&#x9;this.updUI();&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;this.drawUndoList();&#xA;&#x9;},&#xA;&#x9;showMenu: function(e, isContext, mp) {&#xA;&#x9;&#x9;var btn = this.button;&#xA;&#x9;&#x9;document.popupNode = btn.ownerDocument.popupNode = btn;&#xA;&#x9;&#x9;if(!mp)&#xA;&#x9;&#x9;&#x9;mp = this.mp;&#xA;&#x9;&#x9;if(&quot;openPopupAtScreen&quot; in mp)&#xA;&#x9;&#x9;&#x9;mp.openPopupAtScreen(e.screenX, e.screenY, isContext);&#xA;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;mp.showPopup(btn, e.screenX, e.screenY, isContext ? &quot;context&quot; : &quot;popup&quot;, null, null);&#xA;&#x9;},&#xA;&#x9;openMenu: function() {&#xA;&#x9;&#x9;var mp = this.mp;&#xA;&#x9;&#x9;if(&quot;openPopup&quot; in mp)&#xA;&#x9;&#x9;&#x9;mp.openPopup(this.button, &quot;after_start&quot;);&#xA;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;mp.showPopup(this.button, -1, -1, &quot;popup&quot;, &quot;bottomleft&quot;, &quot;topleft&quot;);&#xA;&#x9;},&#xA;&#x9;drawUndoList: function() {&#xA;&#x9;&#x9;var mp = this.mp;&#xA;&#x9;&#x9;//while(mp.hasChildNodes())&#xA;&#x9;&#x9;//&#x9;mp.removeChild(mp.lastChild);&#xA;&#x9;&#x9;mp.textContent = &quot;&quot;;&#xA;&#xA;&#x9;&#x9;var wc = this.closedWindowCount;&#xA;&#x9;&#x9;var tc = this.closedTabCount;&#xA;&#x9;&#x9;var ss = this.ss;&#xA;&#x9;&#x9;var canRestoreLastSession = &quot;restoreLastSession&quot; in ss &amp;&amp; ss.canRestoreLastSession&#xA;&#x9;&#x9;if(!wc &amp;&amp; !tc &amp;&amp; !canRestoreLastSession) {&#xA;&#x9;&#x9;&#x9;mp.hidePopup();&#xA;&#x9;&#x9;&#x9;return false;&#xA;&#x9;&#x9;}&#xA;&#xA;&#x9;&#x9;this._undoWindowItems = wc &amp;&amp; JSON.parse(ss.getClosedWindowData());&#xA;&#x9;&#x9;this._undoTabItems    = tc &amp;&amp; JSON.parse(ss.getClosedTabData(window));&#xA;&#x9;&#x9;var df = document.createDocumentFragment();&#xA;&#xA;&#x9;&#x9;this.options.menuTemplate.forEach(function(sid, indx, arr) {&#xA;&#x9;&#x9;&#x9;switch(sid) {&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;closedWindows&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;wc &amp;&amp; this.addUndoWindowsList(df);&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;restoreClosedWindows&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;wc &gt; this.options.hideRestoreAllForSingleEntry&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;restoreAllWindows&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;restoreAllWindowsAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;for(var i = 0; i &lt; &quot; + this._undoWindowItems.length + &quot;; ++i) undoCloseWindow();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;clearClosedWindows&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;wc &amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;clearWindowsHistory&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;clearWindowsHistoryAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.parentNode.undoCloseTabsList.clearUndoWindowsList();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;closedTabs&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;tc &amp;&amp; this.addUndoTabsList(df);&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;restoreClosedTabs&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;tc &gt; this.options.hideRestoreAllForSingleEntry&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;restoreAllTabs&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;restoreAllTabsAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;for(var i = 0; i &lt; &quot; + this._undoTabItems.length + &quot;; ++i) this.parentNode.parentNode.undoCloseTabsList.undoCloseTab();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;clearClosedTabs&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;tc &amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;clearTabsHistory&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;clearTabsHistoryAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.parentNode.undoCloseTabsList.clearUndoTabsList();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;clearAll&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;wc &amp;&amp; tc&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;|| wc &amp;&amp; arr.indexOf(&quot;clearClosedWindows&quot;) == -1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;|| tc &amp;&amp; arr.indexOf(&quot;clearClosedTabs&quot;) == -1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;clearAllHistory&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;clearAllHistoryAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.parentNode.undoCloseTabsList.clearAllLists();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;restoreLastSession&quot;: // Gecko 2.0+&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;canRestoreLastSession &amp;&amp; df.appendChild(this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;label: _localize(&quot;restoreLastSession&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;accesskey: _localize(&quot;restoreLastSessionAccesskey&quot;),&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;tooltiptext: &quot;&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.parentNode.undoCloseTabsList.ss.restoreLastSession();&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;}));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;buttonMenu&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;let cbMenu = this.cbMenu;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if(cbMenu)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;df.appendChild(cbMenu);&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;case &quot;separator&quot;:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;if(df.hasChildNodes() &amp;&amp; df.lastChild.localName != &quot;menuseparator&quot;)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;df.appendChild(document.createElement(&quot;menuseparator&quot;));&#xA;&#x9;&#x9;&#x9;&#x9;break;&#xA;&#x9;&#x9;&#x9;&#x9;default:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Components.utils.reportError(this.errPrefix + 'Invalid template entry: &quot;' + sid + '&quot;');&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}, this);&#xA;&#xA;&#x9;&#x9;while(df.hasChildNodes() &amp;&amp; df.lastChild.localName == &quot;menuseparator&quot;)&#xA;&#x9;&#x9;&#x9;df.removeChild(df.lastChild);&#xA;&#xA;&#x9;&#x9;this._undoWindowItems = this._undoTabItems = null;&#xA;&#xA;&#x9;&#x9;var show = df.hasChildNodes();&#xA;&#x9;&#x9;if(show)&#xA;&#x9;&#x9;&#x9;mp.appendChild(df);&#xA;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;mp.hidePopup();&#xA;&#x9;&#x9;return show;&#xA;&#x9;},&#xA;&#x9;addUndoWindowsList: function(undoPopup) {&#xA;&#x9;&#x9;// Based on code from chrome://browser/content/browser.js&#xA;&#x9;&#x9;// Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a1pre) Gecko/20090824 Minefield/3.7a1pre&#xA;&#xA;&#x9;&#x9;var keys = this.options.accesskeys.closedWindows;&#xA;&#x9;&#x9;this._undoWindowItems.forEach(function(undoItem, i) {&#xA;&#x9;&#x9;&#x9;var tabs = undoItem.tabs;&#xA;&#x9;&#x9;&#x9;var key = keys &amp;&amp; keys.charAt(i % keys.length);&#xA;&#x9;&#x9;&#x9;var keyPrefix = keys &amp;&amp; (key + this.options.accesskeyPostfix);&#xA;&#x9;&#x9;&#x9;var mi = this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;label: keyPrefix + &quot;(%count) %title&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;.replace(&quot;%title&quot;, undoItem.title)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;.replace(&quot;%count&quot;, tabs.length),&#xA;&#x9;&#x9;&#x9;&#x9;accesskey: key,&#xA;&#x9;&#x9;&#x9;&#x9;&quot;class&quot;: &quot;menuitem-iconic bookmark-item menuitem-with-favicon&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;undoCloseWindow(&quot; + i + &quot;);&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;cb_index: i,&#xA;&#x9;&#x9;&#x9;&#x9;cb_type: &quot;window&quot;&#xA;&#x9;&#x9;&#x9;});&#xA;&#x9;&#x9;&#x9;if(this.cm)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;context&quot;, this.cmId);&#xA;&#x9;&#x9;&#x9;var selectedTab = tabs[undoItem.selected - 1];&#xA;&#x9;&#x9;&#x9;var icon = selectedTab.image || selectedTab.attributes &amp;&amp; selectedTab.attributes.image;&#xA;&#x9;&#x9;&#x9;if(icon)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;image&quot;, this.cachedIcon(icon));&#xA;&#x9;&#x9;&#x9;//if(selectedTab.entries &amp;&amp; selectedTab.entries.length) // Can be [] for about:blank&#xA;&#x9;&#x9;&#x9;//&#x9;mi.setAttribute(&quot;tooltiptext&quot;, selectedTab.entries[selectedTab.index - 1].url);&#xA;&#x9;&#x9;&#x9;var uris = [];&#xA;&#x9;&#x9;&#x9;tabs.forEach(function(tab) {&#xA;&#x9;&#x9;&#x9;&#x9;if(!tab.entries || !tab.entries.length) // Can be [] for about:blank&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;&#x9;var url = this.convertURI(tab.entries[tab.index - 1].url, 120);&#xA;&#x9;&#x9;&#x9;&#x9;uris.push((tab == selectedTab &amp;&amp; tabs.length &gt; 1 ? &quot;*&quot; : &quot;&quot;) + url);&#xA;&#x9;&#x9;&#x9;}, this);&#xA;&#x9;&#x9;&#x9;if(uris.length)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;tooltiptext&quot;, uris.join(&quot; \n&quot;));&#xA;&#x9;&#x9;&#x9;if(i == 0)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;key&quot;, &quot;key_undoCloseWindow&quot;);&#xA;&#x9;&#x9;&#x9;undoPopup.appendChild(mi);&#xA;&#x9;&#x9;}, this);&#xA;&#x9;},&#xA;&#x9;addUndoTabsList: function(undoPopup) {&#xA;&#x9;&#x9;// Based on code from chrome://browser/content/browser.js&#xA;&#x9;&#x9;// Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.3a1pre) Gecko/20090824 Minefield/3.7a1pre&#xA;&#xA;&#x9;&#x9;var keys = this.options.accesskeys.closedTabs;&#xA;&#x9;&#x9;this._undoTabItems.forEach(function(undoItem, i) {&#xA;&#x9;&#x9;&#x9;var key = keys &amp;&amp; keys.charAt(i % keys.length);&#xA;&#x9;&#x9;&#x9;var keyPrefix = keys &amp;&amp; (key + this.options.accesskeyPostfix);&#xA;&#x9;&#x9;&#x9;var mi = this.createElement(&quot;menuitem&quot;, {&#xA;&#x9;&#x9;&#x9;&#x9;label: keyPrefix + undoItem.title,&#xA;&#x9;&#x9;&#x9;&#x9;accesskey: key,&#xA;&#x9;&#x9;&#x9;&#x9;class: &quot;menuitem-iconic bookmark-item menuitem-with-favicon&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;oncommand: &quot;this.parentNode.parentNode.undoCloseTabsList.undoCloseTab(&quot; + i + &quot;);&quot;,&#xA;&#x9;&#x9;&#x9;&#x9;tooltiptext: this.convertURI(undoItem.state.entries[undoItem.state.index - 1].url),&#xA;&#x9;&#x9;&#x9;&#x9;cb_index: i,&#xA;&#x9;&#x9;&#x9;&#x9;cb_type: &quot;tab&quot;&#xA;&#x9;&#x9;&#x9;});&#xA;&#x9;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;&#x9;undoItem.state&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; &quot;attributes&quot; in undoItem.state&#xA;&#x9;&#x9;&#x9;&#x9;&amp;&amp; &quot;privateTab-isPrivate&quot; in undoItem.state.attributes&#xA;&#x9;&#x9;&#x9;) // https://addons.mozilla.org/addon/private-tab/&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;privateTab-isPrivate&quot;, &quot;true&quot;);&#xA;&#x9;&#x9;&#x9;if(this.cm)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;context&quot;, this.cmId);&#xA;&#x9;&#x9;&#x9;var image = undoItem.image // Firefox&#xA;&#x9;&#x9;&#x9;&#x9;|| undoItem.state &amp;&amp; undoItem.state.attributes &amp;&amp; undoItem.state.attributes.image; // SeaMonkey&#xA;&#x9;&#x9;&#x9;if(image)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;image&quot;, this.cachedIcon(image));&#xA;&#x9;&#x9;&#x9;if(i == 0)&#xA;&#x9;&#x9;&#x9;&#x9;mi.setAttribute(&quot;key&quot;, &quot;key_undoCloseTab&quot;);&#xA;&#x9;&#x9;&#x9;undoPopup.appendChild(mi);&#xA;&#x9;&#x9;}, this);&#xA;&#x9;},&#xA;&#x9;checkForMiddleClick: function(e, upd) {&#xA;&#x9;&#x9;var mi = e.target;&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;&quot;doCommand&quot; in mi&#xA;&#x9;&#x9;&#x9;&amp;&amp; e.button == 1&#xA;&#x9;&#x9;&#x9;&amp;&amp; mi.parentNode == e.currentTarget&#xA;&#x9;&#x9;) {&#xA;&#x9;&#x9;&#x9;mi.doCommand();&#xA;&#x9;&#x9;&#x9;if(upd)&#xA;&#x9;&#x9;&#x9;&#x9;upd();&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;this.drawUndoList();&#xA;&#x9;&#x9;}&#xA;&#x9;},&#xA;&#x9;crop: function(s, crop) {&#xA;&#x9;&#x9;if(crop == undefined)&#xA;&#x9;&#x9;&#x9;crop = 500;&#xA;&#x9;&#x9;if(s.length &lt;= crop)&#xA;&#x9;&#x9;&#x9;return s;&#xA;&#x9;&#x9;var start = Math.round(crop*0.6);&#xA;&#x9;&#x9;return s.substr(0, start) + &quot;…&quot; + s.substr(start - crop);&#xA;&#x9;},&#xA;&#x9;convertURI: function(uri, crop) {&#xA;&#x9;&#x9;try {&#xA;&#x9;&#x9;&#x9;uri = losslessDecodeURI({ spec: uri });&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;catch(e) {&#xA;&#x9;&#x9;&#x9;Components.utils.reportError(e);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;return this.crop(uri, crop);&#xA;&#x9;},&#xA;&#x9;cachedIcon: function(src) {&#xA;&#x9;&#x9;src = src.replace(/[&amp;#]-moz-resolution=\d+,\d+$/, &quot;&quot;); // Firefox 22.0a1&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;!/^https?:/.test(src)&#xA;&#x9;&#x9;&#x9;// IDN, see https://bugzilla.mozilla.org/show_bug.cgi?id=311045&#xA;&#x9;&#x9;&#x9;|| /^https?:\/\/[^.:\/]+\.[^a-z0-9-]+(?:\/|$)/.test(src)&#xA;&#x9;&#x9;&#x9;|| this.appName == &quot;SeaMonkey&quot; &amp;&amp; this.appVersion &lt;= 2&#xA;&#x9;&#x9;&#x9;|| this.appName == &quot;Firefox&quot;   &amp;&amp; this.appVersion &lt;= 3.5&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;return src;&#xA;&#x9;&#x9;return &quot;moz-anno:favicon:&quot; + src; // https://bugzilla.mozilla.org/show_bug.cgi?id=467828&#xA;&#x9;},&#xA;&#x9;updUI: function() {&#xA;&#x9;&#x9;var tabsCount = this.closedTabCount;&#xA;&#x9;&#x9;var dis = !tabsCount &amp;&amp; !this.closedWindowCount;&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;dis&#xA;&#x9;&#x9;&#x9;&amp;&amp; this.options.useMenu&#xA;&#x9;&#x9;&#x9;&amp;&amp; this.options.menuTemplate.indexOf(&quot;restoreLastSession&quot;) != -1&#xA;&#x9;&#x9;&#x9;&amp;&amp; &quot;restoreLastSession&quot; in this.ss &amp;&amp; this.ss.canRestoreLastSession&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;dis = false;&#xA;&#x9;&#x9;this.button.disabled = dis;&#xA;&#x9;&#x9;setTimeout(function(_this) {&#xA;&#x9;&#x9;&#x9;_this.updTooltip(tabsCount);&#xA;&#x9;&#x9;}, 0, this);&#xA;&#x9;},&#xA;&#x9;updTooltip: function(tabsCount) {&#xA;&#x9;&#x9;if(tabsCount === undefined)&#xA;&#x9;&#x9;&#x9;tabsCount = this.closedTabCount;&#xA;&#x9;&#x9;var lastTabTip = &quot;&quot;;&#xA;&#x9;&#x9;if(tabsCount) {&#xA;&#x9;&#x9;&#x9;//~ todo: try optimize JSON.parse() usage (can we use cached this._undoTabItems here?)&#xA;&#x9;&#x9;&#x9;// Or update tooltipText only on mouseover&#xA;&#x9;&#x9;&#x9;let undoTabItems = JSON.parse(this.ss.getClosedTabData(window));&#xA;&#x9;&#x9;&#x9;let lastItem = undoTabItems[0];&#xA;&#x9;&#x9;&#x9;lastTabTip = &quot; \n&quot; + this.crop(lastItem.title)&#xA;&#x9;&#x9;&#x9;&#x9;+ &quot; \n&quot; + this.convertURI(lastItem.state.entries[lastItem.state.index - 1].url);&#xA;&#x9;&#x9;}&#xA;&#x9;&#x9;this.button.tooltipText = _localize(&quot;restoreTab&quot;) + lastTabTip;&#xA;&#x9;},&#xA;&#x9;get wm() {&#xA;&#x9;&#x9;delete this.wm;&#xA;&#x9;&#x9;return this.wm = Components.classes[&quot;@mozilla.org/appshell/window-mediator;1&quot;]&#xA;&#x9;&#x9;&#x9;.getService(Components.interfaces.nsIWindowMediator);&#xA;&#x9;},&#xA;&#x9;updUIGlobal: function() {&#xA;&#x9;&#x9;var isSeaMonkey = this.appName == &quot;SeaMonkey&quot;;&#xA;&#x9;&#x9;var ws = this.wm.getEnumerator(isSeaMonkey ? null : &quot;navigator:browser&quot;);&#xA;&#x9;&#x9;const id = this.button.id;&#xA;&#x9;&#x9;while(ws.hasMoreElements()) {&#xA;&#x9;&#x9;&#x9;let win = ws.getNext();&#xA;&#x9;&#x9;&#x9;if(!isSeaMonkey || this.isBrowserWindow(win)) {&#xA;&#x9;&#x9;&#x9;&#x9;let btn = win.document.getElementById(id);&#xA;&#x9;&#x9;&#x9;&#x9;if(btn &amp;&amp; &quot;undoCloseTabsList&quot; in btn) {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;let ucl = btn.undoCloseTabsList;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;ucl.ensureSessionsInitialized(ucl.updUI, ucl);&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;}&#xA;&#x9;},&#xA;&#x9;isBrowserWindow: function(win) {&#xA;&#x9;&#x9;var loc = window.location.href;&#xA;&#x9;&#x9;return loc == &quot;chrome://browser/content/browser.xul&quot;&#xA;&#x9;&#x9;&#x9;|| loc == &quot;chrome://navigator/content/navigator.xul&quot;;&#xA;&#x9;},&#xA;&#x9;ensureSessionsInitialized: function(callback, context) {&#xA;&#x9;&#x9;var _this = this;&#xA;&#x9;&#x9;var stopTime = Date.now() + 3e3;&#xA;&#x9;&#x9;(function ensureInitialized() {&#xA;&#x9;&#x9;&#x9;try {&#xA;&#x9;&#x9;&#x9;&#x9;_this.ss.getClosedTabCount(window);&#xA;&#x9;&#x9;&#x9;&#x9;callback.call(context);&#xA;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;catch(e) {&#xA;&#x9;&#x9;&#x9;&#x9;if(Date.now() &gt; stopTime) {&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Components.utils.reportError(&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;_this.errPrefix&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;+ &quot;Can't initialize: nsISessionStore.getClosedTabCount() failed&quot;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;Components.utils.reportError(e);&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;}&#xA;&#x9;&#x9;&#x9;setTimeout(ensureInitialized, 50);&#xA;&#x9;&#x9;})();&#xA;&#x9;}&#xA;};&#xA;&#xA;if(!this.undoCloseTabsList.options.useMenu &amp;&amp; this.undoCloseTabsList.cm) {&#xA;&#x9;this.oncontextmenu = function(e) {&#xA;&#x9;&#x9;if(&#xA;&#x9;&#x9;&#x9;e.target != this&#xA;&#x9;&#x9;&#x9;|| e.ctrlKey || e.shiftKey || e.altKey || e.metaKey&#xA;&#x9;&#x9;&#x9;|| !this.undoCloseTabsList.mp.hasChildNodes()&#xA;&#x9;&#x9;)&#xA;&#x9;&#x9;&#x9;return;&#xA;&#x9;&#x9;e.preventDefault();&#xA;&#x9;&#x9;this.undoCloseTabsList.showMenu(e); // Show menu without &quot;context&quot; flag&#xA;&#x9;};&#xA;}&#xA;if(this.undoCloseTabsList.options.rightClickToUndoCloseTab) {&#xA;&#x9;this.oncontextmenu = function(e) {&#xA;&#x9;&#x9;if(e.target == this &amp;&amp; !e.ctrlKey &amp;&amp; !e.shiftKey &amp;&amp; !e.altKey &amp;&amp; !e.metaKey)&#xA;&#x9;&#x9;&#x9;e.preventDefault();&#xA;&#x9;};&#xA;}&#xA;&#xA;this.disabled = true;&#xA;setTimeout(function(_this) {&#xA;&#x9;_this.undoCloseTabsList.init();&#xA;}, 0, this);&#xA;&#xA;//===================&#xA;// Styles&#xA;// Used icons from Undo Closed Tabs Button extension&#xA;&#xA;// Styles can't override hardcoded icon&#xA;var icon = this.ownerDocument.getAnonymousElementByAttribute(this, &quot;class&quot;, &quot;toolbarbutton-icon&quot;);&#xA;if(icon)&#xA;&#x9;icon.src = &quot;&quot;;&#xA;else&#xA;&#x9;this.image = &quot;&quot;;&#xA;&#xA;var cssStr = '\&#xA;&#x9;@namespace url(&quot;http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul&quot;);\n\&#xA;&#x9;@-moz-document url(&quot;%windowURL%&quot;) {\n\&#xA;&#x9;&#x9;%button% {\n\&#xA;&#x9;&#x9;&#x9;list-style-image: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAoCAYAAABdGbwdAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gUYESAhfaTaRAAAAB1pVFh0Q29tbWVudAAAAAAAQ3JlYXRlZCB3aXRoIEdJTVBkLmUHAAAJUklEQVRo3tWaf4xcVRXHv+fc++77Nb93t7vb7vY3RRaCiAgpshRqgqIJEiUigjWpiNHIH/5rQohBJeEvA4p/GInyhxgMBSqCNmgQCCK/LFZbS6Et3d222+50d2Zn3sy89+69/vFmFxo1EZPJdm4yyUzmfT/35Nzz3j3n3EcAcGC6SlprxxiTH109XCoohArQ+AAjBkQ9RvPE8dkFZl5k5mRifND2O18CgLWWSuWyyudleO/d96x78fnnJk7Onj5fG/iCHW1h/w1IAEAErRMhGK2R4aGDH7/6mv3f+e5dyeJi2qnXaimQCfuZL7PrSHiedAtA+MrLL1/06iuvfi4FbSN2IFh2ke9NYpcnIWiTwpoEU+8e/ZNS3q4CcCLxZLNeQweA6Xf+UgQJISABJKeqtc3k5iZXrx6HGwQgoiV/L9kD2GwSBkFbi3YrQvX41OSpau1vAJ4WApKIBICk3/lLEUTWggFYclTgBjkulCvwg9BaGCJLZ63A2bHKthV51FyYZ3ZUkNkLfp9Vfc3PIsgYoVNICMANAuOHATxXQUkBawigzN+Zxp41FzHDKgUvDOAGgQEAnUJaY8RySPcxX/7j2GnPWJvT2gYAJVKyFoLBRCDOwpOIQd0Fs90JrLVn3dVCMIRkDcBqbQNjbXJgupoaY9DPfDkxPlgGIACYXzzy+FCz0Sw4jgtmhiAmKwjWWhCRpeyGhjUG1tLyVsAsIKWD5mKj8PAjTw7tuOWzZ4bXDkkAlW5s9y1f/vKJp7c0G025f//+wgvPv7ApijprPT+AFBJCCGthSacJdJqQNQYEshbQBBhmySQECSHYdT1qNqK19//ogcm/7tv7zsTERN0PfM3Mtp/5NDa+9t7aYvMjscZlQWUVDQyuCirlshfkQjhKWRhD7aiJ+nwVUaMOJrSYaE5KZ9Hxg9ALcj5L5UdRKze/cKYzP3cqai2csUrSa6Vi7nVrLPczn9ygsNfxw3VevlAqlAZRqgygWMhb6SiCNYjbLdSqp6zV6due6xzwXKeq407cbneUZTmk/FxJesGQtryh0WyohfkzaCzMo9NcXEg7raOApX7mCyco/qS8asRbs36jLZcrCAOfmBkmTU07anC0WEs6rcUjI0OV39904w1Pbr9m216jk7nFeg3GaMsstJCOEModVcqVvh9YP1dEqrXfbrVGSDoj/cyXuWIJ+XwR+SCEVAo6SdBs1HVjYa7arNcLzLSw9YrLf3r7zq+89rHLPtp46aU/56pnFsqNqL3Oshx2pAqkowKSkpgNCBZCCrTyebTbEaQQ/c1XrgulHDiOAyklovoCmvX5aFWltDvN+YkQwtzyhZve2Hb11XOPP/Hk6od+/vD1s6fnLrIsRweGVvvCUdIYqyyRRJrCCgYRwVEOlKMgHdnffMEEZgIxETMj7rQRt5rRp7/4+Wd3fOnmo/889HY4edVk7TdPPTXy6GO7ts7MnrrZkhjO54vIlSogFui029BpAtvdSokBIgITod/5EiCAskkEM4RgkGCeq1ZDzw/s5FWTdQDJI48+tvWtd47cNjQ6VimUB+D6IeK4A2sMlHLQsQakUxARyFgQqJuI9Tefl6paAnW9xiAQNRpNzxoDABGA1vjYmhOB7x+NFuup1hp+ECKr5zJvi8zjxJQZDNjlaqmf+XKpN9LNNLOfFhRFUfDKa28Ux8bH/aNHj3hSCFMqFg7PHD95aa7Z8I0xECy6WalGxqWM07X6fWvct3xJyzOg2xoAjDEcRVF+zx+fu+DY9Mymv+978/JUm/EwXyhWhkfCQqkMwEIpASKDODbvL64zo+0ytq/5Mk0SGK2zgtcCQZhD0ikF707NXHds+nhiiYaDQnm9F+bdfLGCQrEIzw8sEYGYQcRZiUMEZE83ABbGaCRJAgL1NV8KooZJtduKIscYA+koBLmCVztzemuaJvCDEKvWjKE0MAwvyMHoFMZoSlot6DRFmiRI4hhJEiNOEiRJTHGnA611woI7ggj9zKfLJ7c/H7Xjzak2o37gw5EKzAwigFlASAnHVRBSgolhrYUxBibV0FojTVPoNEGiE6RJiiRO0I4iOI48EQbeISGY+pkvr712+56FWm1/1GqNu65rHEdZKR1Ix4EQAllSYLP+ibVLDSoYbWGshtEGRmto0/0kKcXtDgdBMFWulKeIQH3NT6z9pARCALn/3pf8wIMANFKg2W1b9i2fuudKDoABAGv+R8AMgOoFYwPJuaDv5Vg6E/EBrLnyw+d/s9Zs7xTC/Y8Xa91BMfQeeunNgw92E7DkHNH33EEeALSN2nHeJZdAKgcEXj4msd2coJMkmD64fweAB7ua+jmi77mDBADkKhVZKha7CZddPgVYqktCa1GrVM7SnCP63jnowHS1AKAMAErJrNjLUu6uYRbWWFhYGG3hqCX7UD4wXW0ufV8p/QVjAz2NIgZwHgB/5223Xun5eUgWcBynu2ZZA4lgIVlACAlX+dh5661Xdp8b550D+p4OKg8M/mwxindWxjZi/br1yBcLEEKgMV/F6ZMzYJiTknnay5dKYbFSajRbg8eOHcH88WMohO5DALCS+vnq3Fd76iC/uCrZcOHFslQsIwh8EAjN+jzOzE5Pbd82ed/mTRtOPrtnz+b5emOLE5TWwg0+0YpaqNVqOPbW/pQIWEl9u37K6ektVhwckoOVAYRhgEZtHlOH9h2aOXyw+u1vfePOH9//w78QCAuLzfNZBRuV55Vc10UQ+BgYqCBfqciV1vf8Ia2UAykFhBConpzGfd+7+87Z2Vn/jq/dfvye7/9gy68f3/2AG+bLGzZ9CO1WG2kSQwuGkAKOdCAdsaL6njuIQGDBkEKABWNurup+/Y47ZlqtFu/a/du71m+ZKA+OjmGxXoPnuWgZDWYGd/snK63v9WB035Ph7rZ6/MSJ/NKfF1904a+mDh8yAMCURbPg7NqsSWVxLuh7HEFnd+MOHzm64eYv75x84/VXbwwLpeG1G7Od1PcVWq32cueN7Htdt5XU99xBaRynOkmlUQajY+vx+t599wgpMXHpFRgcXQtYA2sNtDZZm8AYGFikOkGSxilZi5XU9zwP2nbdZ545NTf/qVw+B6U8OMqBlArCESDKXh3RiUaaZp23OOkg7sSIFhsYHh78nRCMldS/+Idnru+pg6arjRuU5JH/Rxyn5iQArKR+bCC3u5cO+hd/jGcqDFddEwAAAABJRU5ErkJggg==&quot;) !important;\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(0, 24px, 24px, 0) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;&#x9;%button%:hover {\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(0, 48px, 24px, 24px) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;&#x9;%button%[disabled=&quot;true&quot;] {\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(0, 72px, 24px, 48px) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;&#x9;toolbar[iconsize=&quot;small&quot;] %button% {\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(24px, 16px, 40px, 0) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;&#x9;toolbar[iconsize=&quot;small&quot;] %button%:hover {\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(24px, 32px, 40px, 16px) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;&#x9;toolbar[iconsize=&quot;small&quot;] %button%[disabled=&quot;true&quot;] {\n\&#xA;&#x9;&#x9;&#x9;-moz-image-region: rect(24px, 48px, 40px, 32px) !important;\n\&#xA;&#x9;&#x9;}\n\&#xA;&#x9;}'&#xA;&#x9;.replace(/%windowURL%/g, window.location.href)&#xA;&#x9;.replace(/%button%/g, &quot;#&quot; + this.id);&#xA;var cssURI = this.cssURI = Components.classes[&quot;@mozilla.org/network/io-service;1&quot;]&#xA;&#x9;.getService(Components.interfaces.nsIIOService)&#xA;&#x9;.newURI(&quot;data:text/css,&quot; + encodeURIComponent(cssStr), null, null);&#xA;var sss = this.sss = Components.classes[&quot;@mozilla.org/content/style-sheet-service;1&quot;]&#xA;&#x9;.getService(Components.interfaces.nsIStyleSheetService);&#xA;if(!sss.sheetRegistered(cssURI, sss.USER_SHEET))&#xA;&#x9;sss.loadAndRegisterSheet(cssURI, sss.USER_SHEET);&#xA;&#xA;&#xA;this.onDestroy = function(reason) {&#xA;&#x9;this.undoCloseTabsList.destroy();&#xA;&#x9;if(reason == &quot;update&quot; || reason == &quot;delete&quot;) {&#xA;&#x9;&#x9;let sss = this.sss;&#xA;&#x9;&#x9;let cssURI = this.cssURI;&#xA;&#x9;&#x9;if(sss.sheetRegistered(cssURI, sss.USER_SHEET))&#xA;&#x9;&#x9;&#x9;sss.unregisterSheet(cssURI, sss.USER_SHEET);&#xA;&#x9;}&#xA;};&#xA;if(this.undoCloseTabsList.options.useMenu) {&#xA;&#x9;this.type = &quot;menu&quot;;&#xA;&#x9;this.orient = &quot;horizontal&quot;;&#xA;}" cb-mode="0"/><toolbarbutton id="custombuttons-button1" label="Автовыделение ссылок" tooltiptext="Автовыделение ссылок" class="toolbarbutton-1 chromeclass-toolbar-additional" context="custombuttons-contextpopup" cb-stdicon="custombuttons-stdicon-1" cb-oncommand="/*CODE*/" cb-init="/*Initialization Code*/var listener = {&#xA; handleEvent: function(event) {&#xA;  content.removeEventListener(event.type, this, false);&#xA;&#xA;  switch(event.type) {&#xA;   case &quot;dragstart&quot;:&#xA;    if(event.view.top != content)&#xA;     return;&#xA;    event.preventDefault();&#xA;&#xA;    var utils = document.commandDispatcher.focusedWindow.&#xA;    QueryInterface(Components.interfaces.nsIInterfaceRequestor).&#xA;    getInterface(Components.interfaces.nsIDOMWindowUtils);&#xA;&#xA;    utils.sendMouseEvent(&quot;mousedown&quot;, event.clientX, event.clientY, event.button, 1, utils.MODIFIER_ALT);&#xA;&#xA;    this.target = event.target;&#xA;    content.addEventListener(&quot;click&quot;, this, false);&#xA;    content.addEventListener(&quot;mouseup&quot;, this, false);&#xA;    break;&#xA;   case &quot;mouseup&quot;:&#xA;    if(event.target != this.target)&#xA;     content.removeEventListener(&quot;click&quot;, this, false);&#xA;    break;&#xA;   case &quot;click&quot;:&#xA;    event.preventDefault();&#xA;    break;&#xA;  }&#xA; }&#xA;}&#xA;&#xA;addEventListener(&quot;dragstart&quot;, listener, true);" cb-mode="0"/></toolbarpalette>
	
	<!-- Thunderbird -->
	<toolbarpalette id="MailToolbarPalette"/> <!-- main window -->
	<toolbarpalette id="MsgComposeToolbarPalette"/> <!-- message compose -->
	
	<!-- Sunbird -->
	<toolbarpalette id="calendarToolbarPalette"/>
	
	<!-- KompoZer -->
	<toolbarpalette id="NvuToolbarPalette"/>

</overlay>